#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset
# set -o xtrace

if [ -z $1 ]; then
  echo "Usage: compro-site newprojectname"
  exit 0
fi

NAME=${1:0:64}

BITBUCKET=1
# Allow flag to override config.
while getopts "b" OPTION
do
  case $OPTION in
    b)
      BITBUCKET=0
      ;;
  esac
done

# Run all the commands in order.
compro-make ${NAME}

cd ${NAME}
compro-alias
compro-prep
compro-db
compro-install
compro-fs
compro-server
compro-hosts
compro-git

if [ ${BITBUCKET} > 0 ]; then
  compro-bitbucket
fi

# Finish up.
drush @${NAME}.dev-${USER} uli maintenance /
cd ..
echo "Done."
exit 0