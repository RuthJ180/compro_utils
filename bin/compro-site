#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset
# set -o xtrace

NAME=''
BITBUCKET=0

# Allow flag to override config.
while getopts "b" OPTION
do
  case $OPTION in
    b)
      BITBUCKET=1
      ;;
  esac
done

NAME=${@:$OPTIND:1}

if [ -z "$NAME" ]; then
  echo "Usage: compro-site -options newprojectname"
  exit 1
fi

# Run all the commands in order.
compro-make ${NAME}

cd ${NAME}
compro-alias
compro-prep
compro-db
compro-install
compro-fs
compro-server
compro-hosts
compro-git

if [ $BITBUCKET = 1 ]; then
  compro-bitbucket
fi

# Finish up.
drush @${NAME}.dev-${USER} uli maintenance /
cd ..
echo "Done."
exit 0
