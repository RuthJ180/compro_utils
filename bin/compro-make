#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset
# set -o xtrace

if [ -z $1 ]; then
  echo "Usage: compro-make newprojectname"
  exit 0
fi

BRANCH="master"

# Allow flag to override config.
while getopts "g:" OPTION
do
  case $OPTION in
    g)
      BRANCH="$OPTARG"
      ;;
  esac
done

NAME=${@:$OPTIND:1}

# Download Drupal and all required modules/themes/libraries.

if [ ${BRANCH:0:1} == "8" ]; then
  drush make --no-cache "https://bitbucket.org/alexfisher/compro_install_profile/raw/${BRANCH}/compro.make" ${NAME}
else
  drush make "https://bitbucket.org/alexfisher/compro_install_profile/raw/${BRANCH}/make/compro.make" ${NAME}
fi